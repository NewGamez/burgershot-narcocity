<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Burgershot Intern</title>
<link rel="stylesheet" href="style.css">
</head>
    
    <!-- ================= ABMELDUNG MODAL ================= -->
<div class="modal-backdrop" id="abmModal">
    <div class="modal">
        <h2>ğŸ“… Neue Abmeldung</h2>

        <input type="date" id="abmVon">
        <input type="date" id="abmBis">
        <input type="text" id="abmGrund" placeholder="Grund">

        <button onclick="submitAbmeldungUI()">Einreichen</button>
        <button onclick="closeAbmModal()">Abbrechen</button>
    </div>
</div>
<body>

<header>
    <a href="index.html" class="brand-link">ğŸ” Burgershot Intern</a>
    <div>
        <span id="welcomeUser"></span>
        <button onclick="logout()">Logout</button>
    </div>
</header>

<section class="dashboard">

    <div class="grid-top">

        <div class="panel big">
            <div class="panel-header">ğŸ“¢ NEWS & INFOS</div>
            <p>Wichtige AnkÃ¼ndigungen.</p>
        </div>

        <div class="panel big" onclick="openAbmModal()">
            <div class="panel-top">
                <span class="panel-header">ğŸ“… ABMELDUNGEN</span>
                <span id="abmCounter" class="badge">0 aktiv</span>
            </div>
            <p>Abwesenheiten & UrlaubsantrÃ¤ge.</p>
        </div>

        <div class="panel big" id="meineAbmeldungenPanel">
            <div class="panel-header">ğŸ“‹ Meine Abmeldungen</div>
            <div id="meineAbmeldungenList"></div>
        </div>

        <div class="panel big">
            <div class="panel-top">
                <span class="panel-header">ğŸ“ BEWERBER</span>
                <span id="bewerberCounter" class="badge">0 neu</span>
            </div>
            <p>Neue Bewerbungen prÃ¼fen.</p>
        </div>

        <div class="panel big center">
            <div class="panel-header">ğŸ“‹ Service</div>
        </div>

    </div>

    <div class="grid-bottom">
        <div class="panel small">ğŸ”<br>Orders</div>
        <div class="panel small">ğŸ›’<br>Lager</div>
        <div class="panel small">ğŸµ<br>Musik</div>
        <div class="panel small">ğŸ‘•<br>Kleidung</div>
    </div>

    <div id="adminPanel" class="management-bar"
         onclick="location.href='management.html'">
        <div>â­ Management Center</div>
        <div>Personalverwaltung & Systemsteuerung</div>
    </div>

</section>

<!-- PIN MODAL -->
<div class="modal-backdrop" id="pinModal">
    <div class="modal">
        <h2>ğŸ”’ PIN Ã¤ndern</h2>
        <p>Bitte setze deine persÃ¶nliche 4-stellige PIN.</p>
        <input type="password" id="newPin" maxlength="4" placeholder="Neue PIN">
        <button onclick="savePin()">Speichern</button>
    </div>
</div>

<script src="script.js"></script>
<script>
requireLogin();

document.addEventListener("DOMContentLoaded", () => {

    const user = sessionStorage.getItem("loggedInUser");
    const accs = getAccounts();

    if (!user || !accs[user]) {
        logout();
        return;
    }

    renderMeineAbmeldungen();

    document.getElementById("welcomeUser").innerText = "Eingeloggt als: " + user;

    if (isAdmin()) {
        document.getElementById("adminPanel").style.display = "flex";
    }

    if (accs[user].isFirstLogin === true) {
        document.getElementById("pinModal").classList.add("active");
    }

    document.getElementById("abmCounter").innerText =
        getOffeneAbmeldungenCount() + " offen"

    document.getElementById("bewerberCounter").innerText =
        getNeueBewerberCount() + " neu";
});

function savePin() {
    const pin = document.getElementById("newPin").value.trim();
    const user = sessionStorage.getItem("loggedInUser");
    const accs = getAccounts();

    if (!/^\d{4}$/.test(pin)) {
        alert("PIN muss genau 4 Zahlen enthalten.");
        return;
    }

    accs[user].password = pin;
    accs[user].isFirstLogin = false;
    saveAccounts(accs);

    document.getElementById("pinModal").classList.remove("active");
    alert("PIN erfolgreich gesetzt!");
}
</script>

</body>
</html>
