<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Burgershot Intern</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<!-- ================= ABMELDUNG MODAL ================= -->
<div class="modal-backdrop" id="abmModal">
    <div class="modal">
        <h2>ğŸ“… Neue Abmeldung</h2>

        <input type="date" id="abmVon">
        <input type="date" id="abmBis">
        <input type="text" id="abmGrund" placeholder="Grund">

        <button onclick="submitAbmeldungUI()">Einreichen</button>
        <button onclick="closeAbmModal()">Abbrechen</button>
    </div>
</div>

<!-- ================= HEADER ================= -->
<header>
    <a href="index.html" class="brand-link">ğŸ” Burgershot Intern</a>
    <div>
        <span id="welcomeUser"></span>
        <button onclick="logout()">Logout</button>
    </div>
</header>

<!-- ================= DASHBOARD ================= -->
<section class="dashboard">

    <!-- ===== DASHBOARD HERO ===== -->
<div class="dashboard-hero">

    <div class="hero-left">
        <img src="assets/logo.png" class="hero-logo">
        <div>
            <h1>Willkommen bei Burgershot Intern</h1>
            <p>Teamverwaltung & Organisation auf einen Blick.</p>
        </div>
    </div>

    <div class="hero-stats">

        <div class="stat-box">
            <div class="stat-number" id="statUsers">0</div>
            <div class="stat-label">Accounts</div>
        </div>

        <div class="stat-box">
            <div class="stat-number" id="statOffen">0</div>
            <div class="stat-label">Offene Abmeldungen</div>
        </div>

    </div>

</div>

    <div class="grid-top">

        <!-- NEWS -->
        <div class="panel big">
            <div class="panel-header">ğŸ“¢ NEWS & INFOS</div>
            <p>Wichtige AnkÃ¼ndigungen.</p>
        </div>

        <!-- ABMELDUNGEN -->
        <div class="panel big" onclick="openAbmModal()">
            <div class="panel-top">
                <span class="panel-header">ğŸ“… ABMELDUNGEN</span>
                <span id="abmCounter" class="badge">0 offen</span>
            </div>
            <p>Abwesenheiten & UrlaubsantrÃ¤ge.</p>
        </div>

        <!-- MEINE ABMELDUNGEN -->
        <div class="panel big">
            <div class="panel-header">ğŸ“‹ Meine Abmeldungen</div>
            <div id="meineAbmeldungenList"></div>
        </div>

        <!-- BEWERBER -->
        <div class="panel big">
            <div class="panel-top">
                <span class="panel-header">ğŸ“ BEWERBER</span>
                <span id="bewerberCounter" class="badge">0 neu</span>
            </div>
            <p>Neue Bewerbungen prÃ¼fen.</p>
        </div>

    </div>

    <!-- SMALL PANELS -->
    <div class="grid-bottom">
        <div class="panel small">ğŸ”<br>Orders</div>
        <div class="panel small">ğŸ›’<br>Lager</div>
        <div class="panel small">ğŸµ<br>Musik</div>
        <div class="panel small">ğŸ‘•<br>Kleidung</div>
    </div>

    <!-- MANAGEMENT BAR -->
    <div id="adminPanel" class="management-bar"
         onclick="location.href='management.html'">
        <div>â­ Management Center</div>
        <div>Personalverwaltung & Systemsteuerung</div>
    </div>

</section>

<!-- ================= PIN MODAL ================= -->
<div class="modal-backdrop" id="pinModal">
    <div class="modal">
        <h2>ğŸ”’ PIN Ã¤ndern</h2>
        <p>Bitte setze deine persÃ¶nliche 4-stellige PIN.</p>
        <input type="password" id="newPin" maxlength="4" placeholder="Neue PIN">
        <button onclick="savePin()">Speichern</button>
    </div>
</div>

<!-- ================= SCRIPT ================= -->
<script src="script.js"></script>

<script>
requireLogin();

document.addEventListener("DOMContentLoaded", () => {

    const user = sessionStorage.getItem("loggedInUser");
    const accs = getAccounts();

    if (!user || !accs[user]) {
        logout();
        return;
    }

    document.getElementById("welcomeUser").innerText =
        "Eingeloggt als: " + user;

    if (isAdmin()) {
        document.getElementById("adminPanel").style.display = "flex";
    }

    if (accs[user].isFirstLogin === true) {
        document.getElementById("pinModal").classList.add("active");
    }

    // Offene Abmeldungen Counter
    document.getElementById("abmCounter").innerText =
        getOffeneAbmeldungenCount() + " offen";

    // Bewerber Counter (falls vorhanden)
    if (typeof getNeueBewerberCount === "function") {
        document.getElementById("bewerberCounter").innerText =
            getNeueBewerberCount() + " neu";
    }

    renderMeineAbmeldungen();
});

/* ================= PIN SPEICHERN ================= */
function savePin() {

    const pin = document.getElementById("newPin").value.trim();
    const user = sessionStorage.getItem("loggedInUser");
    const accs = getAccounts();

    if (!/^\d{4}$/.test(pin)) {
        alert("PIN muss genau 4 Zahlen enthalten.");
        return;
    }

    accs[user].password = pin;
    accs[user].isFirstLogin = false;

    saveAccounts(accs);

    document.getElementById("pinModal").classList.remove("active");
    alert("PIN erfolgreich gesetzt!");
}
</script>

</body>
</html>
