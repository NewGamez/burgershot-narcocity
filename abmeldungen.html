<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Abmeldungen - Burgershot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="header-left"><a href="index.html" class="brand-link">üçî Burgershot Intern</a></div>
    <div class="header-right">
        <button class="add-btn" onclick="openModal()">+ Neue Abmeldung</button>
        <button class="logout-btn" onclick="logout()" style="margin-left:10px;">Logout</button>
    </div>
</header>

<section class="dashboard">
    <div class="panel full-width management-container">
        <div class="panel-header">
            <span>üìÖ Aktuelle Abmeldungen</span>
        </div>
        
        <div class="account-table-header">
            <span>Mitarbeiter</span>
            <span>Zeitraum</span>
            <span>Grund</span>
            <span style="text-align: right;">Aktion</span>
        </div>
        <div id="absenceList">
            </div>
    </div>
</section>

<div class="modal-backdrop" id="absenceModal" style="display:none;">
    <div class="modal">
        <h2>Neue Abmeldung</h2>
        <p>Trage hier deine Abwesenheit ein.</p>
        
        <input type="text" id="inName" placeholder="Dein Name" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #faac15; background:#111; color:white;">
        
        <input type="text" id="inTime" placeholder="Zeitraum (z.B. 25.02. - 02.03.)" style="width:100%; padding:10px; margin-bottom:10px; border-radius:8px; border:1px solid #faac15; background:#111; color:white;">
        
        <textarea id="inReason" placeholder="Grund (optional)" style="width:100%; padding:10px; margin-bottom:20px; border-radius:8px; border:1px solid #faac15; background:#111; color:white; height:80px;"></textarea>
        
        <div style="display:flex; gap:10px;">
            <button class="add-btn" style="flex:1; height:40px;" onclick="addEntry()">Eintragen</button>
            <button class="delete-btn" style="flex:1; height:40px;" onclick="closeModal()">Abbrechen</button>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    requireLogin();

    function openModal() { document.getElementById("absenceModal").style.display = "flex"; }
    function closeModal() { document.getElementById("absenceModal").style.display = "none"; }

    // Funktion zum Hinzuf√ºgen
    function addEntry() {
        const name = document.getElementById("inName").value.trim();
        const time = document.getElementById("inTime").value.trim();
        const reason = document.getElementById("inReason").value.trim() || "Kein Grund angegeben";

        if (name === "" || time === "") {
            alert("Bitte Name und Zeitraum ausf√ºllen!");
            return;
        }

        // 1. Daten holen (aus script.js Funktion)
        const currentAbsences = getAbsences();

        // 2. Neuen Eintrag erstellen
        const newEntry = {
            id: Date.now(),
            name: name,
            time: time,
            reason: reason
        };

        // 3. Hinzuf√ºgen und Speichern
        currentAbsences.push(newEntry);
        saveAbsences(currentAbsences);

        // 4. UI aufr√§umen
        document.getElementById("inName").value = "";
        document.getElementById("inTime").value = "";
        document.getElementById("inReason").value = "";
        closeModal();
        
        // 5. Liste neu laden
        renderList();
    }

    // Funktion zum L√∂schen
    function deleteEntry(id) {
        if(confirm("Eintrag wirklich l√∂schen?")) {
            let list = getAbsences();
            list = list.filter(item => item.id !== id);
            saveAbsences(list);
            renderList();
        }
    }

    // Liste anzeigen
    function renderList() {
        const container = document.getElementById("absenceList");
        const data = getAbsences();
        container.innerHTML = "";

        if (data.length === 0) {
            container.innerHTML = "<p style='text-align:center; padding:20px; color:#555;'>Keine Abmeldungen vorhanden.</p>";
            return;
        }

        data.reverse().forEach(item => {
            const row = document.createElement("div");
            row.className = "account-row";
            row.innerHTML = `
                <span>${item.name}</span>
                <span>${item.time}</span>
                <span style="color:#888; font-size:0.8rem;">${item.reason}</span>
                <div style="text-align:right;">
                    <button class="delete-btn" onclick="deleteEntry(${item.id})">L√∂schen</button>
                </div>
            `;
            container.appendChild(row);
        });
    }

    // Beim Laden der Seite Liste zeigen
    window.onload = renderList;
</script>
</body>
</html>
