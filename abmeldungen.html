<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Abmeldungen | Burgershot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <a href="index.html" class="brand-link">‚Üê Zur√ºck zum Dashboard</a>
    <button onclick="document.getElementById('modal').style.display='flex'">+ Neue Abmeldung</button>
</header>

<section class="dashboard">
    <div class="panel big full-width" style="margin-bottom: 30px; cursor: default;">
        <div class="panel-header">üìã MEINE ABMELDUNGEN & STATUS</div>
        <p style="margin-bottom: 20px; opacity: 0.7;">Hier siehst du den aktuellen Status deiner Antr√§ge.</p>
        
        <div id="meineAbmeldungenList">
            </div>
    </div>

    <div id="adminArea" style="display:none;">
        <div class="panel big full-width" style="cursor: default;">
            <div class="panel-header">üõ°Ô∏è ADMIN-VERWALTUNG (Alle Antr√§ge)</div>
            <div class="account-table">
                <div class="table-head">
                    <span>Mitarbeiter</span>
                    <span>Zeitraum</span>
                    <span>Status</span>
                    <span style="text-align:right;">Aktionen</span>
                </div>
                <div id="absenceList"></div>
            </div>
        </div>
    </div>
</section>

<div class="modal-backdrop" id="modal">
    <div class="modal">
        <h2>üìÖ Neue Abmeldung</h2>
        <input type="text" id="abmVon" placeholder="Von (z.B. 24.02.)">
        <input type="text" id="abmBis" placeholder="Bis (z.B. 01.03.)">
        <textarea id="abmGrund" class="input-field" placeholder="Grund..." style="width:100%; height:80px; margin-top:10px;"></textarea>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button onclick="submitAbmeldungUI()" style="flex:1;">Absenden</button>
            <button onclick="document.getElementById('modal').style.display='none'" style="background:#444; flex:1;">Abbrechen</button>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    requireLogin();

    // Seite initialisieren
    window.onload = () => {
        renderMeineAbmeldungen(); // Zeigt dem User seine eigenen Sachen
        
        if(isAdmin()) {
            document.getElementById("adminArea").style.display = "block";
            renderAdminList(); // Zeigt Admins alle Antr√§ge
        }
    };

    // Hilfsfunktion f√ºr die Admin-Tabelle auf dieser Seite
    function renderAdminList() {
        const list = document.getElementById("absenceList");
        if(!list) return;
        list.innerHTML = "";
        
        getAbmeldungen().forEach((a, i) => {
            const row = document.createElement("div");
            row.className = "table-row";
            row.innerHTML = `
                <span>${a.user}</span>
                <span>${a.von} - ${a.bis}</span>
                <span class="role-badge" style="border-color: currentColor;">${a.status}</span>
                <div class="action-cell">
                    <button class="rank-btn" onclick="approveAbm(${i}); location.reload();">‚úî</button>
                    <button class="rank-btn" onclick="rejectAbm(${i}); location.reload();" style="color:#ff4d4d;">‚úñ</button>
                </div>
            `;
            list.appendChild(row);
        });
    }
</script>
</body>
</html>
