<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Abmeldungen - Burgershot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="header-left"><a href="index.html" class="brand-link">â† ZurÃ¼ck zum Dashboard</a></div>
    <div class="header-right">
        <button class="add-btn" onclick="openModal()">+ Neue Abmeldung</button>
    </div>
</header>

<section class="dashboard">
    <div class="panel full-width" style="display: block; height: auto;">
        <div class="panel-header">
            <span>ğŸ“… Aktuelle Abmeldungen</span>
        </div>
        
        <div class="table-container">
            <div class="table-head">
                <span>Mitarbeiter</span>
                <span>Zeitraum</span>
                <span>Grund</span>
                <span style="text-align: right;">Aktion</span>
            </div>

            <div id="absenceList"></div>
        </div>
    </div>
</section>

<div class="modal-backdrop" id="absenceModal" style="display:none;">
    <div class="modal">
        <h3>Neue Abmeldung</h3>
        <div class="input-group">
            <input type="text" id="inName" placeholder="Dein Name">
            <input type="text" id="inTime" placeholder="Zeitraum (z.B. 25.02. - 01.03.)">
            <textarea id="inReason" placeholder="Grund der Abwesenheit (optional)"></textarea>
        </div>
        <div class="modal-actions">
            <button class="add-btn" onclick="addEntry()" style="flex:1;">Eintragen</button>
            <button class="logout-btn" onclick="closeModal()" style="flex:1;">Abbrechen</button>
        </div>
    </div>
</div>

<script src="script.js"></script>
<script>
    requireLogin();

    const openModal = () => document.getElementById("absenceModal").style.display = "flex";
    const closeModal = () => document.getElementById("absenceModal").style.display = "none";

    function addEntry() {
        const name = document.getElementById("inName").value.trim();
        const time = document.getElementById("inTime").value.trim();
        const reason = document.getElementById("inReason").value.trim() || "Kein Grund";

        if (!name || !time) return alert("Bitte Name und Zeitraum ausfÃ¼llen!");

        const list = getAbsences();
        list.push({ id: Date.now(), name, time, reason });
        saveAbsences(list);

        // Inputs leeren & schieÃŸen
        document.getElementById("inName").value = "";
        document.getElementById("inTime").value = "";
        document.getElementById("inReason").value = "";
        closeModal();
        renderList();
    }

    function deleteEntry(id) {
        if(confirm("Eintrag wirklich lÃ¶schen?")) {
            const list = getAbsences().filter(item => item.id !== id);
            saveAbsences(list);
            renderList();
        }
    }

    function renderList() {
        const container = document.getElementById("absenceList");
        const data = getAbsences();
        container.innerHTML = "";

        if (data.length === 0) {
            container.innerHTML = "<p class='empty-msg'>Aktuell liegen keine Abmeldungen vor.</p>";
            return;
        }

        // Wir gehen die Liste rÃ¼ckwÃ¤rts durch (neueste oben)
        data.reverse().forEach(item => {
            const row = document.createElement("div");
            row.className = "table-row";
            row.innerHTML = `
                <span class="bold">${item.name}</span>
                <span>${item.time}</span>
                <span class="reason-text">${item.reason}</span>
                <div style="text-align:right;">
                    <button class="delete-btn-small" onclick="deleteEntry(${item.id})">ğŸ—‘ï¸</button>
                </div>
            `;
            container.appendChild(row);
        });
    }

    window.onload = renderList;
</script>
</body>
</html>
