<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Management</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<script>
if (!sessionStorage.getItem("loggedInUser")) {
    window.location.href = "login.html";
}
</script>

<header>
    <div class="header-left">
        <a href="index.html" class="brand-link">üçî Burgershot Intern</a>
    </div>
    <div class="header-right">
        <span id="welcomeUser"></span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</header>

<section class="dashboard">

<div class="big-panel gold">

    <div class="toolbar">
        <button class="btn-primary" id="btnAdd">+ Mitarbeiter hinzuf√ºgen</button>
    </div>

    <table class="employee-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Rang</th>
                <th>Discord-ID</th>
                <th class="actions-col">Aktionen</th>
            </tr>
        </thead>
        <tbody id="empTbody"></tbody>
    </table>

</div>

</section>

<!-- MODAL -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <div class="modal-head">
      <div>Mitarbeiter hinzuf√ºgen</div>
      <button class="btn-secondary" onclick="closeModal()">Schlie√üen</button>
    </div>

    <div class="modal-body">
        <div class="grid">
            <div class="field">
                <label>Discord-ID (nur Zahlen)</label>
                <input id="newDiscordId">
            </div>
            <div class="field">
                <label>Name</label>
                <input id="newName">
            </div>
            <div class="field">
                <label>Rang</label>
                <select id="newRang"></select>
            </div>
        </div>
    </div>

    <div class="modal-footer">
        <button class="btn-secondary" onclick="closeModal()">Abbrechen</button>
        <button class="btn-primary" onclick="confirmAdd()">Hinzuf√ºgen</button>
    </div>
  </div>
</div>

<footer>
    Burgershot Internal System ¬© 2026
</footer>

<script>
const RANKS = ["Cheffe", "Management", "Mitarbeiter_in"];

let user = sessionStorage.getItem("loggedInUser");
document.getElementById("welcomeUser").innerText = "Eingeloggt als: " + user;

let employees = JSON.parse(localStorage.getItem("bs_employees")) || {};

if (!employees[user] || (employees[user].rang !== "Cheffe" && employees[user].rang !== "Management")) {
    window.location.href = "index.html";
}

function logout() {
    sessionStorage.removeItem("loggedInUser");
    window.location.href = "login.html";
}

function saveEmployees(){
    localStorage.setItem("bs_employees", JSON.stringify(employees));
}

function render(){
    const tbody = document.getElementById("empTbody");
    tbody.innerHTML = "";

    Object.entries(employees).forEach(([id, data]) => {

        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${data.name}</td>
            <td>${data.rang}</td>
            <td>${id}</td>
            <td class="actions">
                <button class="btn-secondary" onclick="uprank('${id}')">Uprank</button>
                <button class="btn-secondary" onclick="derank('${id}')">Derank</button>
                <button class="btn-danger" onclick="removeEmployee('${id}')">K√ºndigen</button>
            </td>
        `;

        tbody.appendChild(tr);
    });
}

function uprank(id){
    let i = RANKS.indexOf(employees[id].rang);
    if(i > 0){
        employees[id].rang = RANKS[i - 1];
        saveEmployees();
        render();
    }
}

function derank(id){
    let i = RANKS.indexOf(employees[id].rang);
    if(i < RANKS.length - 1){
        employees[id].rang = RANKS[i + 1];
        saveEmployees();
        render();
    }
}

function removeEmployee(id){
    if(confirm("Account wirklich l√∂schen?")){
        delete employees[id];
        saveEmployees();
        render();
    }
}

function openModal(){
    document.getElementById("modalBackdrop").style.display = "flex";
}

function closeModal(){
    document.getElementById("modalBackdrop").style.display = "none";
}

function confirmAdd(){
    const id = document.getElementById("newDiscordId").value.trim();
    const name = document.getElementById("newName").value.trim();
    const rang = document.getElementById("newRang").value;

    if(!/^\d{10,30}$/.test(id)){
        alert("Ung√ºltige Discord-ID.");
        return;
    }

    employees[id] = { name, rang };
    saveEmployees();
    closeModal();
    render();
}

function initRankSelect(){
    const sel = document.getElementById("newRang");
    RANKS.forEach(r=>{
        const opt = document.createElement("option");
        opt.textContent = r;
        sel.appendChild(opt);
    });
}

document.getElementById("btnAdd").addEventListener("click", openModal);

initRankSelect();
render();
</script>

</body>
</html>
