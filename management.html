<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Management Center | Burgershot</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <a href="index.html" class="brand-link">ğŸ” Burgershot Intern</a>
    <button onclick="location.href='index.html'" style="background: #222; margin-left: auto;">ğŸ  Home</button>
</header>

<section class="dashboard">
    <section class="management-wrapper">
        
        <div class="panel full-width" style="margin-bottom: 20px; padding: 15px;">
            <div style="display: flex; gap: 10px;">
                <button class="nav-btn active" onclick="showTab('tab-accounts', this)">ğŸ‘¤ Accountverwaltung</button>
                <button class="nav-btn" onclick="showTab('tab-mitarbeiter', this)">ğŸ“‹ Mitarbeiterliste</button>
                <button class="nav-btn" onclick="showTab('tab-abmeldungen', this)">ğŸ“… Abmeldungen</button>
            </div>
        </div>

        <div id="tab-accounts" class="mgmt-tab">
            <div class="panel" style="margin-bottom: 20px;">
                <div class="management-header">
                    <h2>ğŸ‘¤ Accountverwaltung</h2>
                    <div class="add-user-bar">
                        <input type="text" id="newName" placeholder="Username">
                        <select id="newRole">
                            <option value="Mitarbeiter">Mitarbeiter</option>
                            <option value="Management">Management</option>
                            <option value="Cheffe">Cheffe</option>
                        </select>
                        <button onclick="addUser()">Erstellen</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">ğŸ” Accounts durchsuchen</div>
                <input type="text" id="accSearch" placeholder="Name eingeben..." onkeyup="filterTable('userList', this.value)" style="width: 100%; margin: 10px 0;">
                <div id="userList" class="account-table"></div>
            </div>
        </div>

        <div id="tab-mitarbeiter" class="mgmt-tab" style="display: none;">
            <div class="panel" style="margin-bottom: 20px;">
                <div class="management-header">
                    <h2>ğŸ“‹ Mitarbeiterliste (IC-Infos)</h2>
                    <div class="add-user-bar">
                        <input type="text" id="maName" placeholder="Name">
                        <input type="text" id="maTel" placeholder="Telefon">
                        <input type="text" id="maGehalt" placeholder="Gehalt (â‚¬)">
                        <button onclick="uiAddMitarbeiter()">HinzufÃ¼gen</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <input type="text" id="maSearch" placeholder="Mitarbeiter suchen..." onkeyup="filterTable('mitarbeiterList', this.value)" style="width: 100%; margin-bottom: 15px;">
                <div class="table-head">
                    <span>Name</span>
                    <span>Telefon</span>
                    <span>Gehalt</span>
                    <span style="text-align: right;">Aktionen</span>
                </div>
                <div id="mitarbeiterList" class="account-table"></div>
            </div>
        </div>

        <div id="tab-abmeldungen" class="mgmt-tab" style="display: none;">
            <div class="panel">
                <div class="panel-header">ğŸ“… Team-Abmeldungen</div>
                <div id="abmList" class="account-table"></div>
            </div>
        </div>

    </section>
</section>

<script src="script.js"></script>
<script>
    requireLogin();
    if(!isAdmin()) window.location.href = "index.html";

    function showTab(tabId, btn) {
        document.querySelectorAll(".mgmt-tab").forEach(tab => tab.style.display = "none");
        document.getElementById(tabId).style.display = "block";
        document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        if(tabId === 'tab-accounts') renderUsers();
        if(tabId === 'tab-mitarbeiter') renderMitarbeiter();
        if(tabId === 'tab-abmeldungen') renderAbmeldungen();
    }

    // --- ACCOUNTS ---
    const roleOrder = ["Cheffe", "Management", "Mitarbeiter"];
    function renderUsers() {
        const list = document.getElementById("userList");
        list.innerHTML = "";
        const accs = getAccounts();
        Object.keys(accs).sort((a,b) => roleOrder.indexOf(accs[a].role) - roleOrder.indexOf(accs[b].role)).forEach(name => {
            const row = document.createElement("div");
            row.className = "table-row";
            row.style.display = "flex"; // Fix fÃ¼r die Suche
            row.innerHTML = `
                <span style="flex:1;">${name}</span>
                <span class="role-badge ${accs[name].role.toLowerCase()}" style="width:100px;">${accs[name].role}</span>
                <div class="action-cell" style="flex:1; justify-content: flex-end;">
                    <button class="rank-btn" onclick="uprank('${name}'); renderUsers();">â¬†</button>
                    <button class="rank-btn" onclick="derank('${name}'); renderUsers();">â¬‡</button>
                    <button class="delete-btn" onclick="removeUser('${name}'); renderUsers();">LÃ¶schen</button>
                </div>`;
            list.appendChild(row);
        });
    }

    // --- MITARBEITER (IC) ---
    const getMitarbeiterData = () => JSON.parse(localStorage.getItem("bs_mitarbeiter_list")) || [];
    const saveMitarbeiterData = (d) => localStorage.setItem("bs_mitarbeiter_list", JSON.stringify(d));

    function uiAddMitarbeiter() {
        const name = document.getElementById("maName").value;
        const tel = document.getElementById("maTel").value;
        const gehalt = document.getElementById("maGehalt").value;
        if(!name) return;
        const list = getMitarbeiterData();
        list.push({name, tel, gehalt});
        saveMitarbeiterData(list);
        renderMitarbeiter();
        document.getElementById("maName").value = "";
        document.getElementById("maTel").value = "";
        document.getElementById("maGehalt").value = "";
    }

    function renderMitarbeiter() {
        const list = document.getElementById("mitarbeiterList");
        list.innerHTML = "";
        getMitarbeiterData().forEach((m, i) => {
            const row = document.createElement("div");
            row.className = "table-row";
            row.style.display = "flex";
            row.innerHTML = `
                <span style="flex:1;">${m.name}</span>
                <span style="flex:1;">${m.tel}</span>
                <span style="flex:1;">${m.gehalt} â‚¬</span>
                <div class="action-cell" style="flex:1; justify-content: flex-end;">
                    <button class="delete-btn" onclick="deleteMA(${i})">Entfernen</button>
                </div>`;
            list.appendChild(row);
        });
    }

    function deleteMA(i) {
        const list = getMitarbeiterData();
        list.splice(i, 1);
        saveMitarbeiterData(list);
        renderMitarbeiter();
    }

    // --- UNIVERSAL FILTER ---
    function filterTable(containerId, val) {
        const query = val.toLowerCase();
        const rows = document.querySelectorAll(`#${containerId} .table-row`);
        rows.forEach(row => {
            const text = row.innerText.toLowerCase();
            row.style.display = text.includes(query) ? "flex" : "none";
        });
    }

    // --- ABMELDUNGEN ---
    function renderAbmeldungen() {
        const c = document.getElementById("abmList");
        c.innerHTML = "";
        getAbmeldungen().reverse().forEach((a) => {
            const row = document.createElement("div");
            row.className = "table-row";
            row.style.display = "flex";
            let sClass = a.status === "genehmigt" ? "status-badge-genehmigt" : (a.status === "abgelehnt" ? "status-badge-abgelehnt" : "status-badge-offen");
            row.innerHTML = `
                <span style="flex:1;">${a.user}</span>
                <span style="flex:1;">${a.von}-${a.bis}</span>
                <span class="${sClass}">${a.status.toUpperCase()}</span>
                <div class="action-cell" style="flex:1; justify-content: flex-end;">
                    ${a.status==="offen"?`<button class="rank-btn" onclick="approveAbm(${a.id});renderAbmeldungen()">âœ”</button><button class="rank-btn" onclick="rejectAbm(${a.id});renderAbmeldungen()">âœ–</button>`:''}
                    <button class="delete-btn" onclick="deleteAbm(${a.id});renderAbmeldungen()">ğŸ—‘</button>
                </div>`;
            c.appendChild(row);
        });
    }

    document.addEventListener("DOMContentLoaded", renderUsers);
</script>
</body>
</html>
