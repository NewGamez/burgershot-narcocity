<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Management Center | Burgershot Intern</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <a href="index.html" class="brand-link">ğŸ” Burgershot Intern</a>
    <button onclick="location.href='index.html'" style="background: #222; margin-left: auto;">ğŸ  Home</button>
</header>

<section class="dashboard">
    <section class="management-wrapper">
        
        <div class="panel full-width" style="margin-bottom: 20px; padding: 15px;">
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="nav-btn active" onclick="showTab('tab-personal', this)">ğŸ‘¥ Personalverwaltung</button>
                <button class="nav-btn" onclick="showTab('tab-abmeldungen', this)">ğŸ“… Alle Abmeldungen</button>
                <button class="nav-btn" onclick="showTab('tab-bewerber', this)">ğŸ“ Bewerbungen</button>
                <button class="nav-btn" onclick="location.href='announcements.html'" style="background: #444;">ğŸ“¢ Werbetexte</button>
            </div>
        </div>

        <div id="tab-personal" class="mgmt-tab">
            <div class="panel" style="margin-bottom: 20px;">
                <div class="management-header">
                    <h2>ğŸ‘¥ Personalverwaltung</h2>
                    <div class="add-user-bar">
                        <input type="text" id="newName" placeholder="Name fÃ¼r Account">
                        <select id="newRole">
                            <option value="Mitarbeiter">Mitarbeiter</option>
                            <option value="Management">Management</option>
                            <option value="Cheffe">Cheffe</option>
                        </select>
                        <button onclick="addUser()">Einstellen</button>
                    </div>
                </div>
            </div>

            <div class="panel">
                <div class="panel-header">ğŸ” Mitarbeiter suchen</div>
                <input type="text" id="userSearch" placeholder="Name eingeben..." onkeyup="filterUsers()" style="width: 100%; margin: 10px 0;">
                
                <div id="userList" class="account-table">
                    </div>
            </div>
        </div>

        <div id="tab-abmeldungen" class="mgmt-tab" style="display: none;">
            <div class="panel">
                <div class="panel-header">ğŸ“… Alle Team-Abmeldungen</div>
                <div id="abmList" class="account-table" style="margin-top: 20px;">
                    </div>
            </div>
        </div>

        <div id="tab-bewerber" class="mgmt-tab" style="display: none;">
            <div class="panel">
                <div class="panel-header">ğŸ“ Bewerbungen im System</div>
                <div id="bewerberList">
                    <p style="opacity: 0.5; padding: 20px; text-align: center;">Aktuell liegen keine neuen Bewerbungen vor.</p>
                </div>
            </div>
        </div>

    </section>
</section>

<script src="script.js"></script>
<script>
    // 1. Zugriffsschutz: Nur eingeloggte Admins/Management
    requireLogin();
    if(!isAdmin()) {
        window.location.href = "index.html";
    }

    // 2. Tab-Logik: Schaltet zwischen den Bereichen um
    function showTab(tabId, btn) {
        // Alle Bereiche verstecken
        document.querySelectorAll(".mgmt-tab").forEach(tab => tab.style.display = "none");
        // GewÃ¤hlten Bereich zeigen
        document.getElementById(tabId).style.display = "block";
        // Button-Styling (Farbe) anpassen
        document.querySelectorAll(".nav-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        // Daten beim Wechsel frisch laden
        if(tabId === 'tab-personal') renderUsers();
        if(tabId === 'tab-abmeldungen') renderAbmeldungen();
    }

    // 3. Mitarbeiter-Liste rendern
    const roleOrder = ["Cheffe", "Management", "Mitarbeiter"];

    function renderUsers() {
        const list = document.getElementById("userList");
        if(!list) return;
        list.innerHTML = "";
        
        const accs = getAccounts(); // Funktion aus script.js

        // Sortieren nach Rang und Anzeigen
        Object.keys(accs)
            .sort((a,b) => roleOrder.indexOf(accs[a].role) - roleOrder.indexOf(accs[b].role))
            .forEach(name => {
                const row = document.createElement("div");
                row.className = "table-row";
                row.innerHTML = `
                    <span>${name}</span>
                    <span class="role-badge ${accs[name].role.toLowerCase()}">${accs[name].role}</span>
                    <div class="action-cell">
                        <button class="rank-btn" onclick="uprank('${name}'); renderUsers();">â¬†</button>
                        <button class="rank-btn" onclick="derank('${name}'); renderUsers();">â¬‡</button>
                        <button class="delete-btn" onclick="removeUser('${name}'); renderUsers();">KÃ¼ndigen</button>
                    </div>`;
                list.appendChild(row);
            });
    }

    // 4. Abmeldungen fÃ¼r das Team verwalten
    function renderAbmeldungen() {
        const c = document.getElementById("abmList");
        if (!c) return;
        c.innerHTML = "";
        
        const alleAbmeldungen = getAbmeldungen(); // Funktion aus script.js

        alleAbmeldungen.reverse().forEach((a) => {
            const row = document.createElement("div");
            row.className = "table-row";
            
            let statusClass = "status-badge-offen";
            if (a.status === "genehmigt") statusClass = "status-badge-genehmigt";
            if (a.status === "abgelehnt") statusClass = "status-badge-abgelehnt";

            row.innerHTML = `
                <span>${a.user}</span>
                <span>${a.von} - ${a.bis}</span>
                <span class="${statusClass}">${a.status.toUpperCase()}</span>
                <div class="action-cell">
                    ${a.status === "offen" ? `
                        <button class="rank-btn" onclick="approveAbm(${a.id}); renderAbmeldungen();">âœ”</button>
                        <button class="rank-btn" onclick="rejectAbm(${a.id}); renderAbmeldungen();">âœ–</button>
                    ` : ''}
                    <button class="delete-btn" onclick="deleteAbm(${a.id}); renderAbmeldungen();">LÃ¶schen</button>
                </div>`;
            c.appendChild(row);
        });
    }

    // 5. Live-Suche
    function filterUsers() {
        const query = document.getElementById("userSearch").value.toLowerCase();
        const rows = document.querySelectorAll("#userList .table-row");
        rows.forEach(row => {
            const name = row.querySelector("span").innerText.toLowerCase();
            row.style.display = name.includes(query) ? "flex" : "none";
        });
    }

    // Initiales Laden beim Seitenstart
    document.addEventListener("DOMContentLoaded", renderUsers);
</script>

</body>
</html>
