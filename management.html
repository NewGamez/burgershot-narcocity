<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Management Center</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <a href="index.html" class="brand-link">ğŸ” Burgershot Intern</a>
</header>

<section class="dashboard">

<div class="panel management-wrapper">

    <!-- ================= TABS ================= -->
    <div class="management-tabs">
        <button class="tab-btn active" onclick="showSection('accounts', this)">Accountverwaltung</button>
        <button class="tab-btn" onclick="showSection('mitarbeiter', this)">Mitarbeiterliste</button>
        <button class="tab-btn" onclick="showSection('dokumente', this)">Dokumente</button>
        <button class="tab-btn" onclick="showSection('sheets', this)">Sheets</button>
    </div>

    <!-- ================= ACCOUNTS ================= -->
    <div id="accounts" class="management-section">

        <h2>ğŸ‘¤ Accountverwaltung</h2>

        <div class="add-user-bar">
            <input type="text" id="newName" placeholder="Name">
            <select id="newRole">
                <option value="Mitarbeiter">Mitarbeiter</option>
                <option value="Management">Management</option>
                <option value="Cheffe">Cheffe</option>
            </select>
            <button onclick="addUser()">Einstellen</button>
        </div>

        <div class="account-table">
            <div class="table-head">
                <span>Name</span>
                <span>Rang</span>
                <span style="text-align:right;">Aktionen</span>
            </div>
            <div id="userList"></div>
        </div>

    </div>

    <!-- ================= MITARBEITERLISTE ================= -->
    <div id="mitarbeiter" class="management-section" style="display:none;">

        <h2>ğŸ“‹ Mitarbeiterliste</h2>

        <div class="add-user-bar">
            <input type="text" id="vorname" placeholder="Vorname">
            <input type="text" id="nachname" placeholder="Nachname">
            <input type="text" id="telefon" placeholder="Tel. Nr.">
            <input type="number" id="gehalt" placeholder="Gehalt">
            <button onclick="addMitarbeiter()">Eintragen</button>
        </div>

        <div class="account-table">
            <div class="table-head">
                <span>Name</span>
                <span>Telefon</span>
                <span style="text-align:right;">Gehalt</span>
                <span style="text-align:right;">Aktionen</span>
            </div>
            <div id="mitarbeiterList"></div>
        </div>

    </div>

    <!-- ================= DOKUMENTE ================= -->
    <div id="dokumente" class="management-section" style="display:none;">
        <h2>ğŸ“‚ Dokumente</h2>
        <p>Hier kÃ¶nnen spÃ¤ter interne Dokumente eingebunden werden.</p>
    </div>

    <!-- ================= SHEETS ================= -->
    <div id="sheets" class="management-section" style="display:none;">
        <h2>ğŸ“Š Google Sheets</h2>
        <ul class="sheet-links">
            <li><a href="https://docs.google.com" target="_blank">ğŸ“ˆ UmsatzÃ¼bersicht</a></li>
            <li><a href="https://docs.google.com" target="_blank">ğŸ“‹ Mitarbeiterplanung</a></li>
        </ul>
    </div>

</div>
</section>

<script src="script.js"></script>

<script>
requireLogin();
if(!isAdmin()) window.location.href = "index.html";

/* ================= TAB SWITCH ================= */
function showSection(id, btn) {

    document.querySelectorAll(".management-section")
        .forEach(sec => sec.style.display = "none");

    document.getElementById(id).style.display = "block";

    document.querySelectorAll(".tab-btn")
        .forEach(b => b.classList.remove("active"));

    if(btn) btn.classList.add("active");
}

/* ================= ACCOUNTS ================= */

const roleOrder = ["Cheffe", "Management", "Mitarbeiter"];

function renderUsers() {
    const list = document.getElementById("userList");
    list.innerHTML = "";
    const accs = getAccounts();

    const sorted = Object.keys(accs).sort((a,b) =>
        roleOrder.indexOf(accs[a].role) - roleOrder.indexOf(accs[b].role)
    );

    sorted.forEach(name => {

        const row = document.createElement("div");
        row.className = "table-row";

        row.innerHTML = `
            <span>${name}</span>
            <span class="role-badge ${accs[name].role.toLowerCase()}">
                ${accs[name].role}
            </span>
            <div class="action-cell">
                <button class="rank-btn" onclick="uprankUser('${name}')">â¬†</button>
                <button class="rank-btn" onclick="derankUser('${name}')">â¬‡</button>
                <button class="delete-btn" onclick="delUser('${name}')">KÃ¼ndigen</button>
            </div>
        `;

        list.appendChild(row);
    });
}

function addUser() {
    const name = document.getElementById("newName").value.trim();
    const role = document.getElementById("newRole").value;
    const accs = getAccounts();

    if(name && !accs[name]) {
        accs[name] = { password: "0000", role: role, isFirstLogin: true };
        saveAccounts(accs);
        renderUsers();
        document.getElementById("newName").value = "";
    }
}

function delUser(name) {
    if(confirm(name + " kÃ¼ndigen?")) {
        const accs = getAccounts();
        delete accs[name];
        saveAccounts(accs);
        renderUsers();
    }
}

function uprankUser(name) {
    const accs = getAccounts();
    const index = roleOrder.indexOf(accs[name].role);
    if(index > 0) {
        accs[name].role = roleOrder[index - 1];
        saveAccounts(accs);
        renderUsers();
    }
}

function derankUser(name) {
    const accs = getAccounts();
    const index = roleOrder.indexOf(accs[name].role);
    if(index < roleOrder.length - 1) {
        accs[name].role = roleOrder[index + 1];
        saveAccounts(accs);
        renderUsers();
    }
}

/* ================= MITARBEITER ================= */

const getMitarbeiter = () =>
    JSON.parse(localStorage.getItem("bs_mitarbeiter")) || [];

const saveMitarbeiter = (data) =>
    localStorage.setItem("bs_mitarbeiter", JSON.stringify(data));

function addMitarbeiter() {

    const vorname = document.getElementById("vorname").value.trim();
    const nachname = document.getElementById("nachname").value.trim();
    const telefon = document.getElementById("telefon").value.trim();
    const gehalt = document.getElementById("gehalt").value.trim();

    if(!vorname || !nachname) {
        alert("Name fehlt.");
        return;
    }

    const list = getMitarbeiter();
    list.push({ vorname, nachname, telefon, gehalt });
    saveMitarbeiter(list);
    renderMitarbeiter();

    document.getElementById("vorname").value = "";
    document.getElementById("nachname").value = "";
    document.getElementById("telefon").value = "";
    document.getElementById("gehalt").value = "";
}

function renderMitarbeiter() {

    const container = document.getElementById("mitarbeiterList");
    container.innerHTML = "";

    const list = getMitarbeiter();

    list.forEach((m, index) => {

        const row = document.createElement("div");
        row.className = "table-row";

        row.innerHTML = `
            <span>${m.vorname} ${m.nachname}</span>
            <span>${m.telefon}</span>
            <span style="text-align:right;">${m.gehalt} â‚¬</span>
            <div class="action-cell">
                <button class="delete-btn" onclick="deleteMitarbeiter(${index})">
                    Entfernen
                </button>
            </div>
        `;

        container.appendChild(row);
    });
}

function deleteMitarbeiter(index) {
    const list = getMitarbeiter();
    list.splice(index, 1);
    saveMitarbeiter(list);
    renderMitarbeiter();
}

document.addEventListener("DOMContentLoaded", () => {
    renderUsers();
    renderMitarbeiter();
});

    function renderAbmeldungen() {

    const container = document.getElementById("abmList");
    container.innerHTML = "";

    const list = getAbmeldungen();

    list.forEach((a, index) => {

        const row = document.createElement("div");
        row.className = "table-row";

        row.innerHTML = `
            <span>${a.user}</span>
            <span>${a.von} - ${a.bis}</span>
            <span>${a.status}</span>
            <div class="action-cell">
                ${a.status === "offen" ? `
                    <button class="rank-btn" onclick="approveAbm(${index})">âœ”</button>
                    <button class="delete-btn" onclick="rejectAbm(${index})">âœ–</button>
                ` : ""}
            </div>
        `;

        container.appendChild(row);
    });
}

function approveAbm(index) {
    const list = getAbmeldungen();
    list[index].status = "genehmigt";
    saveAbmeldungen(list);
    renderAbmeldungen();
}

function rejectAbm(index) {
    const list = getAbmeldungen();
    list[index].status = "abgelehnt";
    saveAbmeldungen(list);
    renderAbmeldungen();
}

document.addEventListener("DOMContentLoaded", () => {
    renderAbmeldungen();
});
</script>

</body>
</html>
