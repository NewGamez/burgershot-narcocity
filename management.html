<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Management Center</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <a href="index.html" class="brand-link">üçî Burgershot Intern</a>
</header>

<section class="dashboard">

    <div class="panel">

        <h2 style="margin-bottom:20px;">üë§ Personalverwaltung</h2>

        <!-- USER HINZUF√úGEN -->
        <div class="add-user-bar" style="margin-bottom:20px;">
            <input type="text" id="newName" placeholder="Name">
            <select id="newRole">
                <option value="Mitarbeiter">Mitarbeiter</option>
                <option value="Management">Management</option>
                <option value="Cheffe">Cheffe</option>
            </select>
            <button onclick="addUser()">Einstellen</button>
        </div>

        <!-- TABELLE -->
        <div class="account-table">

            <div class="table-head">
                <span>Name</span>
                <span>Rang</span>
                <span style="text-align:right;">Aktionen</span>
            </div>

            <div id="userList"></div>

        </div>

    </div>

</section>

<script src="script.js"></script>

<script>

/* ============================= */
/* AUTH CHECK */
/* ============================= */

requireLogin();
if(!isAdmin()) window.location.href = "index.html";

/* ============================= */
/* ROLLEN REIHENFOLGE */
/* ============================= */

const roleOrder = ["Cheffe", "Management", "Mitarbeiter"];

/* ============================= */
/* USERS RENDER */
/* ============================= */

function renderUsers() {

    const list = document.getElementById("userList");
    list.innerHTML = "";

    const accs = getAccounts();

    const sortedUsers = Object.keys(accs).sort((a,b) =>
        roleOrder.indexOf(accs[a].role) -
        roleOrder.indexOf(accs[b].role)
    );

    sortedUsers.forEach(name => {

        const row = document.createElement("div");
        row.className = "table-row";

        row.innerHTML = `
            <span>${name}</span>
            <span class="role-badge ${accs[name].role.toLowerCase()}">
                ${accs[name].role}
            </span>
            <div style="text-align:right;">
                <button class="rank-btn" onclick="uprankUser('${name}')">‚¨Ü</button>
                <button class="rank-btn" onclick="derankUser('${name}')">‚¨á</button>
                <button class="delete-btn" onclick="delUser('${name}')">K√ºndigen</button>
            </div>
        `;

        list.appendChild(row);
    });
}

/* ============================= */
/* USER HINZUF√úGEN */
/* ============================= */

function addUser() {

    const name = document.getElementById("newName").value.trim();
    const role = document.getElementById("newRole").value;
    const accs = getAccounts();

    if(!name) {
        alert("Name fehlt.");
        return;
    }

    if(accs[name]) {
        alert("Name bereits vergeben.");
        return;
    }

    accs[name] = {
        password: "0000",
        role: role,
        isFirstLogin: true
    };

    saveAccounts(accs);
    renderUsers();
    document.getElementById("newName").value = "";
}

/* ============================= */
/* USER L√ñSCHEN */
/* ============================= */

function delUser(name) {

    const accs = getAccounts();

    if(Object.keys(accs).length <= 1) {
        alert("Letzter Account kann nicht gel√∂scht werden.");
        return;
    }

    if(confirm(name + " k√ºndigen?")) {
        delete accs[name];
        saveAccounts(accs);
        renderUsers();
    }
}

/* ============================= */
/* UPRANK */
/* ============================= */

function uprankUser(name) {

    const accs = getAccounts();
    const index = roleOrder.indexOf(accs[name].role);

    if(index > 0) {
        accs[name].role = roleOrder[index - 1];
        saveAccounts(accs);
        renderUsers();
    }
}

/* ============================= */
/* DERANK */
/* ============================= */

function derankUser(name) {

    const accs = getAccounts();
    const index = roleOrder.indexOf(accs[name].role);

    if(index < roleOrder.length - 1) {
        accs[name].role = roleOrder[index + 1];
        saveAccounts(accs);
        renderUsers();
    }
}

/* ============================= */
/* INIT */
/* ============================= */

document.addEventListener("DOMContentLoaded", renderUsers);

</script>

</body>
</html>
