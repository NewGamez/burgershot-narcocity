<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Management Center</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <a href="index.html" class="brand-link">üçî Burgershot Intern</a>
</header>

<section class="dashboard">

    <div class="panel management-wrapper">

        <div class="management-header">
            <h2>üë§ Personalverwaltung</h2>

            <div class="add-user-bar">
                <input type="text" id="newName" placeholder="Name">
                <select id="newRole">
                    <option value="Mitarbeiter">Mitarbeiter</option>
                    <option value="Management">Management</option>
                    <option value="Cheffe">Cheffe</option>
                </select>
                <button onclick="addUser()">Einstellen</button>
            </div>
        </div>

        <div class="account-table">
            <div class="table-head">
                <span>Name</span>
                <span>Rang</span>
                <span style="text-align:right;">Aktionen</span>
            </div>
            <div id="userList"></div>
        </div>

    </div>

</section>

<script src="script.js"></script>
<script>
requireLogin();
if(!isAdmin()) window.location.href = "index.html";

document.addEventListener("DOMContentLoaded", renderUsers);

function renderUsers() {
    const list = document.getElementById("userList");
    list.innerHTML = "";
    const accs = getAccounts();

    const roleOrder = {
        "Cheffe": 0,
        "Management": 1,
        "Mitarbeiter": 2
    };

    // Accounts in Array umwandeln & sortieren
    const sortedUsers = Object.keys(accs).sort((a, b) => {
        return roleOrder[accs[a].role] - roleOrder[accs[b].role];
    });

    sortedUsers.forEach(name => {
        const row = document.createElement("div");
        row.className = "table-row";

        row.innerHTML = `
            <span>${name}</span>
            <span class="role-badge ${accs[name].role.toLowerCase()}">
                ${accs[name].role}
            </span>
            <div class="action-cell">
                <button class="rank-btn" onclick="uprankUser('${name}')">‚¨Ü</button>
                <button class="rank-btn" onclick="derankUser('${name}')">‚¨á</button>
                <button class="delete-btn" onclick="delUser('${name}')">K√ºndigen</button>
            </div>
        `;

        list.appendChild(row);
    });
}

    const roleOrder = ["Mitarbeiter", "Management", "Cheffe"];

function uprankUser(name) {
    const accs = getAccounts();
    const currentRole = accs[name].role;
    const index = roleOrder.indexOf(currentRole);

    if (index < roleOrder.length - 1) {
        accs[name].role = roleOrder[index + 1];
        saveAccounts(accs);
        renderUsers();
    }
}

function derankUser(name) {
    const accs = getAccounts();
    const currentRole = accs[name].role;
    const index = roleOrder.indexOf(currentRole);

    if (index > 0) {
        accs[name].role = roleOrder[index - 1];
        saveAccounts(accs);
        renderUsers();
    }
}

function addUser() {
    const name = document.getElementById("newName").value.trim();
    const role = document.getElementById("newRole").value;
    const accs = getAccounts();

    if(name && !accs[name]) {
        accs[name] = {
            password: "0000",
            role: role,
            isFirstLogin: true
        };
        saveAccounts(accs);
        renderUsers();
        document.getElementById("newName").value = "";
    } else {
        alert("Name ung√ºltig oder bereits vergeben.");
    }
}

function delUser(name) {
    if(confirm(name + " k√ºndigen?")) {
        const accs = getAccounts();
        delete accs[name];
        saveAccounts(accs);
        renderUsers();
    }
}
</script>

</body>
</html>
