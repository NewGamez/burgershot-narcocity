<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Management</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="header-left">
        <a href="index.html" class="brand-link">ğŸ” Burgershot Intern</a>
    </div>
    <div class="header-right">
        <span id="welcomeUser"></span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</header>

<section class="dashboard">

<section class="dashboard">
    <div class="panel large management-container">
        <h2>ğŸ” Personalverwaltung</h2>

        <div class="hiring-bar">
            <input type="text" id="newUsername" placeholder="Name des Mitarbeiters">
            <select id="newRole">
                <option>Mitarbeiter_in</option>
                <option>Management</option>
                <option>Cheffe</option>
            </select>
            <button class="add-btn" onclick="createAccount()">Einstellen</button>
        </div>

        <div class="account-table-header">
            <span>Name</span>
            <span>Rang</span>
            <span style="text-align: right;">Aktionen</span>
        </div>

        <div id="accountList" class="account-list-container">
            </div>
    </div>
</section>
    
<div class="panel large">

    <h2>Erstellte Accounts</h2>
    <div id="accountList"></div>

</div>

</section>

<script src="script.js"></script>
<script>
requireLogin();
setHeaderUser();

if (!isAdmin()) {
    window.location.href = "index.html";
}

// Liste der RÃ¤nge fÃ¼r die Buttons
const rankOrder = ["Mitarbeiter_in", "Management", "Cheffe"];

function createAccount() {
    const username = document.getElementById("newUsername").value.trim();
    const role = document.getElementById("newRole").value;

    if (!username) return alert("Name fehlt!");

    const accounts = getAccounts();
    if (accounts[username]) return alert("Existiert bereits!");

    // Automatisch Passwort 0000 und Flag fÃ¼r ersten Login
    accounts[username] = { 
        password: "0000", 
        role: role, 
        isFirstLogin: true 
    };
    
    saveAccounts(accounts);
    document.getElementById("newUsername").value = "";
    loadAccounts();
}

function changeRank(username, direction) {
    const accounts = getAccounts();
    let currentIndex = rankOrder.indexOf(accounts[username].role);
    let newIndex = currentIndex + direction;

    if (newIndex >= 0 && newIndex < rankOrder.length) {
        accounts[username].role = rankOrder[newIndex];
        saveAccounts(accounts);
        loadAccounts();
    }
}

function loadAccounts() {
    const accounts = getAccounts();
    const list = document.getElementById("accountList");
    list.innerHTML = "";

    // Definition der Hierarchie (hÃ¶chste Zahl = oben)
    const roleWeight = {
        "Cheffe": 3,
        "Management": 2,
        "Mitarbeiter_in": 1
    };

    // Accounts in ein Array umwandeln und sortieren
    const sortedAccounts = Object.keys(accounts).sort((a, b) => {
        const weightA = roleWeight[accounts[a].role] || 0;
        const weightB = roleWeight[accounts[b].role] || 0;
        
        // Erst nach Rang sortieren, bei gleichem Rang alphabetisch nach Name
        if (weightB !== weightA) {
            return weightB - weightA;
        }
        return a.localeCompare(b);
    });

    sortedAccounts.forEach(username => {
        const user = accounts[username];
        const div = document.createElement("div");
        div.className = "account-row";

        let badgeClass = "badge-mitarbeiter";
        if (user.role === "Management") badgeClass = "badge-management";
        if (user.role === "Cheffe") badgeClass = "badge-cheffe";

        div.innerHTML = `
            <span class="user-name">${username}</span>
            <span><span class="role-badge ${badgeClass}">${user.role}</span></span>
            <div class="action-buttons">
                <button class="rank-btn" onclick="changeRank('${username}', 1)">â†‘</button>
                <button class="rank-btn" onclick="changeRank('${username}', -1)">â†“</button>
                <button class="delete-btn" onclick="deleteAccount('${username}')">KÃ¼ndigen</button>
            </div>
        `;
        list.appendChild(div);
    });
}

    // Sortieren, damit Cheffe oben steht
    const sortedUsernames = Object.keys(accounts).sort();

    sortedUsernames.forEach(username => {
        const user = accounts[username];
        const div = document.createElement("div");
        div.className = "account-row";

        // Badge-Klasse bestimmen
        let badgeClass = "badge-mitarbeiter";
        if (user.role === "Cheffe") badgeClass = "badge-cheffe";
        if (user.role === "Management") badgeClass = "badge-management";

        div.innerHTML = `
            <span style="color: white; font-weight: 500;">${username}</span>
            <span><span class="role-badge ${badgeClass}">${user.role}</span></span>
            <div style="text-align: right;">
                <button class="delete-btn" onclick="deleteAccount('${username}')">KÃ¼ndigen</button>
            </div>
        `;

        list.appendChild(div);
    });
}

loadAccounts();
</script>

</body>
</html>
