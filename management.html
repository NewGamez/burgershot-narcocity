<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Burgershot Management</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <div class="header-left"><a href="index.html" class="brand-link">ğŸ” Burgershot Intern</a></div>
    <div class="header-right">
        <span id="welcomeUser"></span>
        <button class="logout-btn" onclick="logout()">Logout</button>
    </div>
</header>

<section class="dashboard">
    <div class="panel large management-container">
        <h2>ğŸ” Personalverwaltung</h2>

        <div class="hiring-bar">
            <input type="text" id="newUsername" placeholder="Name des Mitarbeiters">
            <select id="newRole">
                <option>Mitarbeiter_in</option>
                <option>Management</option>
                <option>Cheffe</option>
            </select>
            <button class="add-btn" onclick="createAccount()">Einstellen</button>
        </div>

        <div class="account-table-header">
            <span>Name</span>
            <span>Rang</span>
            <span style="text-align: right;">Aktionen</span>
        </div>

        <div id="accountList" class="account-list-container"></div>
    </div>
</section>

<script src="script.js"></script>
<script>
    requireLogin();
    setHeaderUser();
    if (!isAdmin()) window.location.href = "index.html";

    const rankOrder = ["Mitarbeiter_in", "Management", "Cheffe"];

    function createAccount() {
        const name = document.getElementById("newUsername").value.trim();
        const role = document.getElementById("newRole").value;
        if (!name) return alert("Name angeben!");
        const accounts = getAccounts();
        if (accounts[name]) return alert("Existiert bereits!");

        accounts[name] = { password: "0000", role: role, isFirstLogin: true };
        saveAccounts(accounts);
        document.getElementById("newUsername").value = "";
        loadAccounts();
    }

    function changeRank(user, dir) {
        const accs = getAccounts();
        let idx = rankOrder.indexOf(accs[user].role);
        let newIdx = idx + dir;
        if (newIdx >= 0 && newIdx < rankOrder.length) {
            accs[user].role = rankOrder[newIdx];
            saveAccounts(accs);
            loadAccounts();
        }
    }

    function deleteAccount(user) {
        if (confirm(`${user} wirklich kÃ¼ndigen?`)) {
            const accs = getAccounts();
            delete accs[user];
            saveAccounts(accs);
            loadAccounts();
        }
    }

    function loadAccounts() {
        const accounts = getAccounts();
        const list = document.getElementById("accountList");
        list.innerHTML = "";

        const weight = { "Cheffe": 3, "Management": 2, "Mitarbeiter_in": 1 };

        const sorted = Object.keys(accounts).sort((a,b) => {
            if (weight[accounts[b].role] !== weight[accounts[a].role]) {
                return weight[accounts[b].role] - weight[accounts[a].role];
            }
            return a.localeCompare(b);
        });

        sorted.forEach(user => {
            const data = accounts[user];
            const div = document.createElement("div");
            div.className = "account-row";
            let bCls = data.role === "Cheffe" ? "badge-cheffe" : (data.role === "Management" ? "badge-management" : "badge-mitarbeiter");

            div.innerHTML = `
                <span>${user}</span>
                <span><span class="role-badge ${bCls}">${data.role}</span></span>
                <div class="action-buttons">
                    <button class="rank-btn" onclick="changeRank('${user}', 1)">â†‘</button>
                    <button class="rank-btn" onclick="changeRank('${user}', -1)">â†“</button>
                    <button class="delete-btn" onclick="deleteAccount('${user}')">KÃ¼ndigen</button>
                </div>
            `;
            list.appendChild(div);
        });
    }

    loadAccounts();
</script>
</body>
</html>
