<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Management Center</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <a href="index.html" class="brand-link">ğŸ” Burgershot Intern</a>
</header>

<section class="dashboard">
<div class="panel">

<!-- ================= TABS ================= -->
<div class="management-tabs">
    <button class="tab-btn active" onclick="showSection('accounts', this)">Accountverwaltung</button>
    <button class="tab-btn" onclick="showSection('mitarbeiter', this)">Mitarbeiterliste</button>
    <button class="tab-btn" onclick="showSection('abmeldungen', this)">Abmeldungen</button>
</div>

<!-- ================= ACCOUNTS ================= -->
<div id="accounts" class="management-section">

<h2>ğŸ‘¤ Personalverwaltung</h2>

<div class="add-user-bar">
    <input type="text" id="newName" placeholder="Name">
    <select id="newRole">
        <option value="Mitarbeiter">Mitarbeiter</option>
        <option value="Management">Management</option>
        <option value="Cheffe">Cheffe</option>
    </select>
    <button onclick="addUser()">Einstellen</button>
</div>

<div class="account-table">
<div class="table-head">
    <span>Name</span>
    <span>Rang</span>
    <span style="text-align:right;">Aktionen</span>
</div>
<div id="userList"></div>
</div>

</div>

<!-- ================= MITARBEITER ================= -->
<div id="mitarbeiter" class="management-section" style="display:none;">

<h2>ğŸ“‹ Mitarbeiterliste</h2>

<div class="add-user-bar">
    <input type="text" id="vorname" placeholder="Vorname">
    <input type="text" id="nachname" placeholder="Nachname">
    <input type="text" id="telefon" placeholder="Telefon">
    <input type="number" id="gehalt" placeholder="Gehalt">
    <button onclick="addMitarbeiterUI()">Eintragen</button>
</div>

<div class="account-table">
<div class="table-head">
    <span>Name</span>
    <span>Telefon</span>
    <span>Gehalt</span>
    <span style="text-align:right;">Aktionen</span>
</div>
<div id="mitarbeiterList"></div>
</div>

</div>

<!-- ================= ABMELDUNGEN ================= -->
<div id="abmeldungen" class="management-section" style="display:none;">

<h2>ğŸ“… Abmeldungen</h2>

<div class="account-table">
<div class="table-head">
    <span>User</span>
    <span>Zeitraum</span>
    <span>Status</span>
    <span style="text-align:right;">Aktionen</span>
</div>
<div id="abmList"></div>
</div>

</div>

</div>
</section>

<script src="script.js"></script>

<script>
requireLogin();
if(!isAdmin()) window.location.href = "index.html";

/* TAB SYSTEM */
function showSection(id, btn){
    document.querySelectorAll(".management-section")
        .forEach(sec => sec.style.display = "none");

    document.getElementById(id).style.display = "block";

    document.querySelectorAll(".tab-btn")
        .forEach(b => b.classList.remove("active"));

    btn.classList.add("active");

    if(id === "accounts") renderUsers();
    if(id === "mitarbeiter") renderMitarbeiter();
    if(id === "abmeldungen") renderAbmeldungen();
}

/* ACCOUNT RENDER */
const roleOrder = ["Cheffe","Management","Mitarbeiter"];

function renderUsers(){
    const list = document.getElementById("userList");
    list.innerHTML = "";

    const accs = getAccounts();

    Object.keys(accs)
    .sort((a,b)=>roleOrder.indexOf(accs[a].role)-roleOrder.indexOf(accs[b].role))
    .forEach(name=>{
        const row=document.createElement("div");
        row.className="table-row";
        row.innerHTML=`
            <span>${name}</span>
            <span class="role-badge ${accs[name].role.toLowerCase()}">${accs[name].role}</span>
            <div class="action-cell">
                <button class="rank-btn" onclick="uprank('${name}')">â¬†</button>
                <button class="rank-btn" onclick="derank('${name}')">â¬‡</button>
                <button class="delete-btn" onclick="removeUser('${name}')">KÃ¼ndigen</button>
            </div>`;
        list.appendChild(row);
    });
}

function addUser() {
    const name = document.getElementById("newName").value.trim();
    const role = document.getElementById("newRole").value;
    const accs = getAccounts();
    
    if (name && !accs[name]) {
        // Neues Konto mit Standard-PW und Pflicht zur Ã„nderung
        accs[name] = { 
            password: "0000", 
            role: role, 
            isFirstLogin: true 
        };
        saveAccounts(accs);
        renderUsers();
        alert("Mitarbeiter " + name + " wurde angelegt. Standard-PW: 0000");
    }
}

function removeUser(name){
    const accs=getAccounts();
    delete accs[name];
    saveAccounts(accs);
    renderUsers();
}

function uprank(name){
    const accs=getAccounts();
    const i=roleOrder.indexOf(accs[name].role);
    if(i>0){
        accs[name].role=roleOrder[i-1];
        saveAccounts(accs);
        renderUsers();
    }
}

function derank(name){
    const accs=getAccounts();
    const i=roleOrder.indexOf(accs[name].role);
    if(i<roleOrder.length-1){
        accs[name].role=roleOrder[i+1];
        saveAccounts(accs);
        renderUsers();
    }
}

/* MITARBEITER RENDER */
function addMitarbeiterUI(){
    addMitarbeiter(
        document.getElementById("vorname").value,
        document.getElementById("nachname").value,
        document.getElementById("telefon").value,
        document.getElementById("gehalt").value
    );
    renderMitarbeiter();
}

function renderMitarbeiter(){
    const c=document.getElementById("mitarbeiterList");
    c.innerHTML="";
    getMitarbeiter().forEach((m,i)=>{
        const row=document.createElement("div");
        row.className="table-row";
        row.innerHTML=`
            <span>${m.vorname} ${m.nachname}</span>
            <span>${m.telefon||"-"}</span>
            <span>${m.gehalt?m.gehalt+" â‚¬":"-"}</span>
            <div>
                <button class="delete-btn" onclick="deleteMitarbeiter(${i});renderMitarbeiter();">Entfernen</button>
            </div>`;
        c.appendChild(row);
    });
}

/* ABMELDUNGEN RENDER (Management Seite) */
function renderAbmeldungen() {
    const c = document.getElementById("abmList");
    if (!c) return;
    c.innerHTML = "";
    
    const alleAbmeldungen = getAbmeldungen();

    alleAbmeldungen.forEach((a) => {
        const row = document.createElement("div");
        row.className = "table-row";
        
        // Logik fÃ¼r die NEUEN Status-Klassen
        let statusClass = "status-badge-offen"; // Standard: Grau
        if (a.status === "genehmigt") statusClass = "status-badge-genehmigt"; // GrÃ¼n
        if (a.status === "abgelehnt") statusClass = "status-badge-abgelehnt"; // Rot

        row.innerHTML = `
            <span>${a.user}</span>
            <span>${a.von} - ${a.bis}</span>
            <span class="${statusClass}">${a.status.toUpperCase()}</span>
            <div class="action-cell">
                ${a.status === "offen" ? `
                    <button class="rank-btn" onclick="approveAbm(${a.id}); renderAbmeldungen();">âœ”</button>
                    <button class="rank-btn" onclick="rejectAbm(${a.id}); renderAbmeldungen();">âœ–</button>
                ` : ''}
                <button class="delete-btn" onclick="deleteAbm(${a.id})">LÃ¶schen</button>
            </div>`;
        c.appendChild(row);
    });
}
    
document.addEventListener("DOMContentLoaded",renderUsers);
</script>

</body>
</html>
